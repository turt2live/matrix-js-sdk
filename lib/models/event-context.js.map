{"version":3,"sources":["../../src/models/event-context.js"],"names":["EventContext","ourEvent","_timeline","_ourEventIndex","_paginateTokens","b","f","_paginateRequests","prototype","getEvent","getTimeline","getOurEventIndex","getPaginateToken","backwards","setPaginateToken","token","addEvents","events","atStart","concat","length","module","exports"],"mappings":"AAAA;;;;;;;;;;;;;;;AAeA;;AAEA;;;;AAIA;;;;;;;;;;;;;;;AAcA,SAASA,YAAT,CAAsBC,QAAtB,EAAgC;AAC5B,SAAKC,SAAL,GAAiB,CAACD,QAAD,CAAjB;AACA,SAAKE,cAAL,GAAsB,CAAtB;AACA,SAAKC,eAAL,GAAuB,EAACC,GAAG,IAAJ,EAAUC,GAAG,IAAb,EAAvB;;AAEA;AACA,SAAKC,iBAAL,GAAyB,EAACF,GAAG,IAAJ,EAAUC,GAAG,IAAb,EAAzB;AACH;;AAED;;;;;;;AAOAN,aAAaQ,SAAb,CAAuBC,QAAvB,GAAkC,YAAW;AACzC,WAAO,KAAKP,SAAL,CAAe,KAAKC,cAApB,CAAP;AACH,CAFD;;AAIA;;;;;AAKAH,aAAaQ,SAAb,CAAuBE,WAAvB,GAAqC,YAAW;AAC5C,WAAO,KAAKR,SAAZ;AACH,CAFD;;AAIA;;;;;AAKAF,aAAaQ,SAAb,CAAuBG,gBAAvB,GAA0C,YAAW;AACjD,WAAO,KAAKR,cAAZ;AACH,CAFD;;AAIA;;;;;;;AAOAH,aAAaQ,SAAb,CAAuBI,gBAAvB,GAA0C,UAASC,SAAT,EAAoB;AAC1D,WAAO,KAAKT,eAAL,CAAqBS,YAAY,GAAZ,GAAkB,GAAvC,CAAP;AACH,CAFD;;AAIA;;;;;;;;;AASAb,aAAaQ,SAAb,CAAuBM,gBAAvB,GAA0C,UAASC,KAAT,EAAgBF,SAAhB,EAA2B;AACjE,SAAKT,eAAL,CAAqBS,YAAY,GAAZ,GAAkB,GAAvC,IAA8CE,KAA9C;AACH,CAFD;;AAIA;;;;;;AAMAf,aAAaQ,SAAb,CAAuBQ,SAAvB,GAAmC,UAASC,MAAT,EAAiBC,OAAjB,EAA0B;AACzD;AACA;;AAEA,QAAIA,OAAJ,EAAa;AACT,aAAKhB,SAAL,GAAiBe,OAAOE,MAAP,CAAc,KAAKjB,SAAnB,CAAjB;AACA,aAAKC,cAAL,IAAuBc,OAAOG,MAA9B;AACH,KAHD,MAGO;AACH,aAAKlB,SAAL,GAAiB,KAAKA,SAAL,CAAeiB,MAAf,CAAsBF,MAAtB,CAAjB;AACH;AACJ,CAVD;;AAYA;;;AAGAI,OAAOC,OAAP,GAAiBtB,YAAjB","file":"event-context.js","sourcesContent":["/*\r\nCopyright 2015, 2016 OpenMarket Ltd\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\"use strict\";\r\n\r\n/**\r\n * @module models/event-context\r\n */\r\n\r\n/**\r\n * Construct a new EventContext\r\n *\r\n * An eventcontext is used for circumstances such as search results, when we\r\n * have a particular event of interest, and a bunch of events before and after\r\n * it.\r\n *\r\n * It also stores pagination tokens for going backwards and forwards in the\r\n * timeline.\r\n *\r\n * @param {MatrixEvent} ourEvent  the event at the centre of this context\r\n *\r\n * @constructor\r\n */\r\nfunction EventContext(ourEvent) {\r\n    this._timeline = [ourEvent];\r\n    this._ourEventIndex = 0;\r\n    this._paginateTokens = {b: null, f: null};\r\n\r\n    // this is used by MatrixClient to keep track of active requests\r\n    this._paginateRequests = {b: null, f: null};\r\n}\r\n\r\n/**\r\n * Get the main event of interest\r\n *\r\n * This is a convenience function for getTimeline()[getOurEventIndex()].\r\n *\r\n * @return {MatrixEvent} The event at the centre of this context.\r\n */\r\nEventContext.prototype.getEvent = function() {\r\n    return this._timeline[this._ourEventIndex];\r\n};\r\n\r\n/**\r\n * Get the list of events in this context\r\n *\r\n * @return {Array} An array of MatrixEvents\r\n */\r\nEventContext.prototype.getTimeline = function() {\r\n    return this._timeline;\r\n};\r\n\r\n/**\r\n * Get the index in the timeline of our event\r\n *\r\n * @return {Number}\r\n */\r\nEventContext.prototype.getOurEventIndex = function() {\r\n    return this._ourEventIndex;\r\n};\r\n\r\n/**\r\n * Get a pagination token.\r\n *\r\n * @param {boolean} backwards   true to get the pagination token for going\r\n *                                  backwards in time\r\n * @return {string}\r\n */\r\nEventContext.prototype.getPaginateToken = function(backwards) {\r\n    return this._paginateTokens[backwards ? 'b' : 'f'];\r\n};\r\n\r\n/**\r\n * Set a pagination token.\r\n *\r\n * Generally this will be used only by the matrix js sdk.\r\n *\r\n * @param {string} token        pagination token\r\n * @param {boolean} backwards   true to set the pagination token for going\r\n *                                   backwards in time\r\n */\r\nEventContext.prototype.setPaginateToken = function(token, backwards) {\r\n    this._paginateTokens[backwards ? 'b' : 'f'] = token;\r\n};\r\n\r\n/**\r\n * Add more events to the timeline\r\n *\r\n * @param {Array} events      new events, in timeline order\r\n * @param {boolean} atStart   true to insert new events at the start\r\n */\r\nEventContext.prototype.addEvents = function(events, atStart) {\r\n    // TODO: should we share logic with Room.addEventsToTimeline?\r\n    // Should Room even use EventContext?\r\n\r\n    if (atStart) {\r\n        this._timeline = events.concat(this._timeline);\r\n        this._ourEventIndex += events.length;\r\n    } else {\r\n        this._timeline = this._timeline.concat(events);\r\n    }\r\n};\r\n\r\n/**\r\n * The EventContext class\r\n */\r\nmodule.exports = EventContext;\r\n"]}